<div class="container mx-auto px-4 py-8">
  <div class="max-w-6xl mx-auto">
    <%= render "shared/flash_messages" %>

    <!-- Password Expiration Warning -->
    <% if @user.password_changed_at.present? && (@user.password_expired? || @user.password_expires_soon?) %>
      <div
        role="alert"
        class="alert <%= @user.password_expired? ? 'alert-error' : 'alert-warning' %> mb-5"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="stroke-current shrink-0 h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
          />
        </svg>

        <div>
          <h3 class="font-bold">
            <%= @user.password_expired? ? "密码已过期" : "密码即将过期" %>
          </h3>

          <div class="text-sm">
            <% if @user.password_expired? %>
              您的密码已过期，为了账户安全，请尽快
            <% else %>
              您的密码将在
              <%= @user.days_until_password_expires %>
              天后过期，建议提前
            <% end %>
            <%= link_to "修改密码", my_security_path, class: "link link-hover font-semibold" %>
            。
          </div>
        </div>
      </div>
    <% end %>

    <div class="mb-6">
      <h1 class="text-4xl font-bold">个人中心</h1>
      <p class="text-base-content/70 mt-2">管理您的账户信息和安全设置</p>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <div class="stat bg-base-200 rounded-box shadow">
        <div class="stat-title">活跃会话</div>
        <div class="stat-value text-primary"><%= @active_sessions_count %></div>
        <div class="stat-desc">当前登录的设备数</div>
      </div>

      <div class="stat bg-base-200 rounded-box shadow">
        <div class="stat-title">总会话数</div>
        <div class="stat-value text-secondary"><%= @total_sessions %></div>
        <div class="stat-desc">历史登录记录</div>
      </div>

      <div class="stat bg-base-200 rounded-box shadow">
        <div class="stat-title">密码状态</div>

        <div class="stat-value <%= @user.password_expired? ? 'text-error' : (@user.password_expires_soon? ? 'text-warning' : 'text-success') %>">
          <% if @user.password_changed_at.present? %>
            <%= @user.password_expired? ? "已过期" : (@user.password_expires_soon? ? "即将过期" : "正常") %>
          <% else %>
            未设置
          <% end %>
        </div>

        <div class="stat-desc">
          <% if @user.password_changed_at.present? %>
            <% if @user.password_expired? %>
              已过期
              <%= @user.days_since_password_change - @user.password_expiration_days %>
              天
            <% elsif @user.password_expires_soon? %>
              <%= @user.days_until_password_expires %>
              天后过期
            <% else %>
              <%= @user.days_until_password_expires %>
              天后过期
            <% end %>
          <% else %>
            请修改密码
          <% end %>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      <%= link_to my_profile_path, class: "card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow" do %>
        <div class="card-body">
          <h2 class="card-title">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              />
            </svg>
            个人信息
          </h2>

          <p>查看和编辑您的个人信息</p>
        </div>
      <% end %>

      <%= link_to my_sessions_path, class: "card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow" do %>
        <div class="card-body">
          <h2 class="card-title">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            登录日志
          </h2>

          <p>管理您的登录设备和会话</p>
        </div>
      <% end %>

      <%= link_to my_security_path, class: "card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow" do %>
        <div class="card-body">
          <h2 class="card-title">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
              />
            </svg>
            安全设置
          </h2>

          <p>修改密码和安全选项</p>
        </div>
      <% end %>

      <%= link_to edit_my_profile_path, class: "card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow" do %>
        <div class="card-body">
          <h2 class="card-title">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              />
            </svg>
            编辑资料
          </h2>

          <p>更新您的个人信息</p>
        </div>
      <% end %>
    </div>

    <!-- Recent Sessions -->
    <% if @recent_sessions.any? %>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <div class="flex justify-between items-center mb-4">
            <h2 class="card-title">最近登录</h2>
            <%= link_to "查看全部", my_sessions_path, class: "btn btn-ghost btn-sm" %>
          </div>

          <div class="overflow-x-auto">
            <table class="table table-zebra">
              <thead>
                <tr>
                  <th>设备</th>
                  <th>IP 地址</th>
                  <th>登录时间</th>
                  <th>状态</th>
                </tr>
              </thead>

              <tbody>
                <% @recent_sessions.each do |session| %>
                  <tr>
                    <td>
                      <div class="flex items-center gap-2">
                        <span class="badge badge-ghost">
                          <%= session.device_info %>
                        </span>

                        <% if session.current? %>
                          <span class="badge badge-primary">当前设备</span>
                        <% end %>
                      </div>
                    </td>

                    <td><%= session.ip_address %></td>

                    <td>
                      <div><%= format_time(session.created_at) %></div>

                      <div class="text-sm text-base-content/50">
                        <%= session.created_at.strftime("%Y-%m-%d %H:%M") %>
                      </div>
                    </td>

                    <td>
                      <% if session.active? %>
                        <span class="badge badge-success">活跃</span>
                      <% else %>
                        <span class="badge badge-ghost">已退出</span>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
