# 自主工作模式

## 概述

当用户发出此指令时，AI 进入完全自主工作模式。AI 将按照规划、听从自己的建议，持续工作直到所有任务完成。用户只需要确认计划，之后完全由 AI 自主完成所有工作。

**⚠️ 重要**：进入自主工作模式后，AI **必须先制定计划并等待用户确认**，**禁止直接开始执行**。

## 步骤

### 1. 查看项目状态和计划

- 读取项目文档，了解当前开发阶段和计划
- 查看进度文档（`docs/phase-*/progress.md`）了解已完成任务
- 查看计划文档（`docs/phase-*/plan.md`）了解待完成任务
- 检查代码库，了解当前实现状态
- 查看 TODO 列表（如 `TEST_COVERAGE_TASKS.md`）

### 2. 制定执行计划（⚠️ 必须执行，不能跳过）

- **必须列出所有待完成任务**：详细列出每个任务的具体内容
- **按优先级排序**：明确任务的执行顺序
- **制定详细的执行步骤**：说明每个任务的具体实现方式
- **⚠️ 必须向用户展示计划**：以清晰的格式展示完整的执行计划
- **⚠️ 必须等待用户确认**：展示计划后，**停止工作，等待用户确认**，**禁止直接开始执行**

### 3. 等待用户确认（⚠️ 关键步骤，不能跳过）

- **⚠️ 必须等待用户确认**：展示计划后，**必须停止工作，等待用户回复**
- **禁止直接开始执行**：在用户确认之前，**禁止执行任何任务**，**禁止开始编写代码**，**禁止运行任何命令**
- **用户确认方式**：用户回复"确认"、"开始"、"好的"、"可以"、"执行"、"go"等表示同意后，才能开始执行
- **如果用户提出修改**：
  - 调整计划
  - **再次展示修改后的计划**
  - **再次等待用户确认**
  - **只有用户确认后才能开始执行**
- **如果用户没有回复**：继续等待，不要开始执行

### 4. 自主执行（确认后）

一旦用户确认，立即开始工作，**按照规划，听从 AI 自己的建议，持续工作直到完成**：

- **按优先级顺序执行**：从高优先级任务开始
- **处理任务依赖**：如果任务A依赖任务B，必须先完成B再完成A
- **每个任务完整完成**（必须按顺序执行，不能跳过任何步骤）：
  1. 实现功能
  2. 编写测试用例
  3. **立即运行测试**：运行 `bin/rails test` 确保通过（如果有失败，立即修复）
  4. **立即检查 linter**：运行 `bin/rubocop` 确保没有错误（如果有错误，立即修复）
  5. **立即更新文档**：更新进度文档和开发笔记（不要等到最后统一更新）
- **持续工作，不要停下来**：
  - ✅ 完成一个任务后**立即**开始下一个，**不要停下来报告**
  - ✅ **不要**在每个任务完成后等待用户反馈
  - ✅ **不要**中途停下来总结单个任务的完成情况
  - ✅ **只有**在所有计划任务都完成后，才向用户报告
  - ✅ 如果任务列表很长，可以每完成 3-5 个任务后简短记录进度（仅记录，不报告给用户），但**不要停下来等待确认**，继续执行下一个任务
- ✅ **进度记录是内部记录**：只用于跟踪工作进度，不是向用户报告，不要停下来等待用户反馈
- **遇到问题**：
  - ⚠️ **必须持续尝试**：遇到问题不能停下来，必须尝试多种解决方案
  - 查阅文档和代码
  - 尝试不同的方法和技术
  - 搜索相关错误信息和解决方案
  - **只有以下情况可以暂时跳过**：
    - 需要用户决策的问题（如设计选择、业务逻辑冲突）- 记录在开发笔记中，继续其他任务
    - 需要外部资源的问题（如需要API密钥、需要访问外部服务）- 记录在开发笔记中，继续其他任务
  - ⚠️ **但最终必须解决所有问题**：
    - 所有测试必须通过（0 失败、0 错误）
    - 所有 linter 错误必须修复（0 错误）
    - 所有代码错误必须修复
    - 只有需要用户决策的问题可以暂时跳过，但必须在报告中明确说明
- **完成标准（硬性要求）**：
  - ⚠️ **必须达到所有标准才能停止工作**，否则继续工作
  - ✅ 所有计划任务完成
  - ✅ **所有测试通过**（`bin/rails test` 必须返回 0 失败、0 错误）
  - ✅ **没有 linter 错误**（`bin/rubocop` 必须返回 0 错误）
  - ✅ 文档已更新
  - ⚠️ **如果测试失败或 linter 报错，必须继续修复，不能停止**

### 5. 工作完成

**重要**：只有达到所有完成标准后，才能向用户报告完成。

**完成报告前必须确认**：
- ✅ 运行 `bin/rails test` 确认所有测试通过（0 失败、0 错误）
- ✅ 运行 `bin/rubocop` 确认没有 linter 错误
- ✅ 所有计划任务已完成

完成后向用户报告：
- 完成的任务列表
- 测试结果（必须显示所有测试通过，0 失败、0 错误）
- Linter 检查结果（必须显示 0 错误）
- 遇到的问题和解决方案
- 需要用户决策的问题（如果有，明确列出）
- **不要提前报告**：如果测试失败或有问题，继续修复，不要报告"完成"
- **报告前必须验证**：运行 `bin/rails test` 和 `bin/rubocop` 确认所有检查都通过

## 重要规则

### 核心原则

1. **完全自主**：用户确认计划后，AI 完全自主工作，不需要用户确认，持续工作直到完成
2. **按规划执行**：按照既定的开发计划（如 `docs/phase-*/plan.md`）执行任务
3. **听从建议**：AI 应该根据自己的分析和建议，自主决定执行顺序和实现方式
4. **持续工作**：完成一个任务后立即开始下一个，不中断、不报告
5. **测试驱动**：每个功能都要编写测试，确保所有测试通过

### 必须遵守的规则

- **⚠️ 必须先制定计划并等待确认**：
  - **禁止直接开始执行**：收到用户指令后，必须先制定计划并展示给用户
  - **禁止跳过确认步骤**：必须等待用户明确确认后才能开始执行
  - **计划必须详细**：计划应该包含所有待完成任务、执行顺序、具体步骤
  - **展示计划后必须停止**：展示计划后，停止所有工作，等待用户确认

- **持续执行，不要中断**：
  - ✅ 确认后，AI 应该像一个连续运行的脚本一样，持续执行直到所有任务完成
  - ✅ 完成一个任务后立即开始下一个，不要停下来报告
  - ✅ 不要在每个任务完成后等待用户反馈
  - ✅ 不要中途停下来总结单个任务的完成情况
  - ✅ 只有所有任务完成后才报告
  - ❌ 禁止在任务之间等待用户反馈
  - ❌ 禁止中途报告单个任务的完成情况

- **不需要中途确认**：除非遇到需要用户决策的问题（如设计选择、业务逻辑冲突）
  - 如果遇到需要用户决策的问题：记录在开发笔记中，明确标注"需要用户决策"，继续其他任务
  - 不要停下来等待用户回复，继续执行其他可以自主完成的任务

- **遇到测试失败必须修复**：如果运行测试发现失败，必须立即修复，不能跳过或记录后继续

- **完成标准是硬性要求**：必须达到所有完成标准（测试通过、linter 通过）才能停止工作

- **测试优先**：每个功能都要有测试，确保测试通过

- **文档同步**：及时更新进度文档和开发笔记

- **代码质量**：遵循项目规范，修复所有错误

- **浏览器调试**：当需要查看界面效果、验证 UI 实现或调试前端问题时，可以使用浏览器工具（`browser_navigate`、`browser_snapshot` 等）进行调试

## 工作示例

```
用户："我去睡觉了，接下来的工作就完全托管给你" 或 "/autonomous-work"

AI：
1. 查看项目状态和计划
2. 制定详细的工作计划
3. 向用户展示计划：
   "根据当前项目状态，我计划完成以下任务：
   - 任务1：实现用户注册功能
   - 任务2：实现用户登录功能
   - 任务3：实现密码重置功能
   ...
   请确认是否开始执行？"
4. ⚠️ **停止工作，等待用户确认**（不开始执行任何任务）

用户："确认"

AI：
1. 开始执行任务 1
2. 完成任务 1，立即开始任务 2（不报告，不等待）
3. 完成任务 2，立即开始任务 3（不报告，不等待）
4. ...持续工作，不中断，不报告...
5. 所有任务完成，所有测试通过
6. 向用户报告完成情况（这是第一次也是最后一次报告）
```

**错误示例（禁止这样做）**：
```
用户："我去睡觉了，接下来的工作就完全托管给你"

AI：
❌ 错误：直接开始执行任务 1
❌ 错误：没有制定计划
❌ 错误：没有等待用户确认
```

**关键点**：
- AI 在确认后应该像执行一个脚本一样，连续执行所有任务
- 不要在单个任务完成后停下来
- 不要在任务之间等待用户反馈
- 只有所有任务完成后才报告
- **执行流程**：任务1 → 测试通过 → 任务2 → 测试通过 → 任务3 → ... → 所有任务完成 → 最终验证 → 报告
- **禁止中断**：除非遇到需要用户决策的问题（记录后继续），否则不能中断执行流程

## 注意事项

- 这是一个**执行方式**指令，不是具体任务内容
- 适用于任何项目、任何开发阶段
- 核心是"自主工作、持续执行、保证质量"
- 用户只需要确认计划，之后完全由 AI 自主完成
- **关键**：AI 应该像执行一个批处理脚本一样，连续执行所有任务，不要中途停下来等待或报告
- **禁止行为**：
  - ❌ **禁止直接开始执行**：收到指令后，必须先制定计划并等待用户确认，禁止直接开始编写代码或执行任务
  - ❌ **禁止跳过确认步骤**：必须等待用户明确确认后才能开始执行
  - ❌ 不要在单个任务完成后停下来
  - ❌ 不要在任务之间等待用户反馈
  - ❌ 不要中途报告单个任务的完成情况
  - ✅ 只有所有任务完成后才报告
