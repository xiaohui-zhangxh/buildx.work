---
description: 资源管理规范。第三方库文件（JavaScript、CSS 等）存放位置、目录结构、包装文件规范等。开发时集成第三方库、管理资源文件时参考此规则。
alwaysApply: false
---

# 资源管理规范

## 核心原则

**重要规则**：所有从外部下载的第三方库文件（JavaScript、CSS 等）必须存放在 `vendor/` 目录下，而不是 `app/assets/` 目录。

## 目录结构

```
vendor/
├── javascript/          # 第三方 JavaScript 库
│   └── highlight.js/    # 例如：highlight.js 相关文件
└── stylesheets/        # 第三方 CSS 样式库（如需要）
    └── highlight/      # 例如：highlight.js 样式文件
```

## 存放规范

### 1. JavaScript 库

- **存放位置**：`vendor/javascript/` 目录
- **目录结构**：保持原始目录结构（如 `vendor/javascript/highlight.js/`）
- **配置方式**：在 `config/importmap.rb` 中配置引用路径

**示例**：

```ruby
# config/importmap.rb
pin "highlight.js/lib/core", to: "highlight.js/lib/core.js"
pin "highlight.js/lib/languages/ruby", to: "highlight.js/lib/languages/ruby.js"
```

### 2. CSS 样式库

- **原始第三方样式文件**：存放在 `vendor/stylesheets/` 目录
- **项目包装文件**：如果需要对第三方样式进行合并、修改或包装，可以在 `app/assets/stylesheets/` 下创建包装文件

**示例**：

- `vendor/stylesheets/highlight/github.css` - 原始第三方文件
- `app/assets/stylesheets/highlight/github-light.css` - 项目包装文件（引用或合并第三方样式）

**包装文件规范**：

```css
/*
 * This is a wrapper file for highlight.js light theme.
 * The original file is located in vendor/assets/stylesheets/highlight/github-light.css
 * Source: https://github.com/highlightjs/highlight.js/blob/11.11.1/src/styles/github.css
 */

/* 直接复制内容或使用 @import（如果支持） */
```

### 3. 其他资源

- **图片、字体等资源**：存放在 `vendor/assets/` 对应子目录

## 文件分类说明

| 文件类型 | 存放位置 | 说明 |
|---------|---------|------|
| **第三方原始文件** | `vendor/` 目录 | 从外部下载的、未经修改的库文件 |
| **项目包装文件** | `app/assets/` 目录 | 对第三方库进行合并、修改或包装的文件 |

## 为什么使用 vendor 目录

- **清晰分离**：区分项目代码和第三方库代码
- **易于管理**：第三方库更新时不会影响项目代码
- **符合 Rails 约定**：Rails 推荐将第三方资源放在 `vendor/` 目录
- **版本控制**：便于跟踪第三方库的版本和来源

## 常见场景

### 场景 1：集成 highlight.js

**步骤**：

1. 下载文件到 `vendor/javascript/highlight.js/`
2. 在 `config/importmap.rb` 中配置路径
3. 下载样式文件到 `vendor/assets/stylesheets/highlight/`
4. 在 `app/assets/stylesheets/highlight/` 创建包装文件（如需要）

### 场景 2：集成第三方 CSS 框架

**步骤**：

1. 下载原始文件到 `vendor/stylesheets/`
2. 在 `app/assets/stylesheets/` 创建包装文件
3. 在包装文件中引用或合并第三方样式

### 场景 3：使用 npm 包

**注意**：对于复杂的模块化库（如 highlight.js），不能使用 `bin/importmap pin`，需要手动集成：

1. 从 JSPM CDN 下载 ES Module 版本
2. 保存到 `vendor/javascript/`
3. 在 `config/importmap.rb` 中配置

## 注意事项

1. **不要使用 `bin/importmap pin` 下载复杂库**：对于模块化库，需要手动下载所有依赖文件
2. **保持原始文件不变**：第三方原始文件放在 `vendor/` 目录，不要修改
3. **包装文件要注明来源**：在包装文件中添加注释，说明原始文件位置
4. **版本控制**：在包装文件中记录第三方库的版本和来源 URL

## 相关文件

- 开发者指南：`docs/DEVELOPER_GUIDE.md`
- Importmap 配置：`config/importmap.rb`
- 样式包装文件：`app/assets/stylesheets/`
