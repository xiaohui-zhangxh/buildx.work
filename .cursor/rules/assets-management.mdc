---
description: 资源管理规范。第三方库文件（JavaScript、CSS 等）存放位置、目录结构、包装文件规范等。开发时集成第三方库、管理资源文件时参考此规则。
alwaysApply: false
---

# 资源管理规范

## 核心原则

### 项目资源 vs 第三方资源

**重要规则**：
- **项目自己的资源**（Logo、图标、项目图片等）：存放在 `app/assets/` 目录
- **第三方库文件**（JavaScript、CSS 等）：存放在 `vendor/` 目录

### 图片资源存放规范 ⭐ **基础规则**

**项目图片资源必须存放在 `app/assets/images/` 目录**，包括：
- Logo 文件（`logo.svg`、`logo-icon.svg` 等）
- Favicon（`icon.svg`、`icon.png`）
- 项目自己的图标、图片等

**为什么放在 `app/assets/images/`**：
- 符合 Rails Asset Pipeline 规范
- 通过 `image_tag` 或 `asset_path` 自动引用
- 支持资源预编译和优化
- 便于版本控制和缓存管理

**示例**：
```
app/assets/images/
├── logo.svg              # 主 Logo
├── logo-icon.svg         # 图标版本
├── logo-horizontal.svg  # 横向版本
├── icon.svg             # Favicon (SVG)
└── icon.png             # Favicon (PNG)
```

**在视图中使用**：
```erb
<!-- 使用 image_tag（推荐） -->
<%= image_tag "logo.svg", alt: "Logo" %>

<!-- 使用 asset_path -->
<%= asset_path('icon.svg') %>
```

## 目录结构

```
vendor/
├── javascript/          # 第三方 JavaScript 库
│   └── highlight.js/    # 例如：highlight.js 相关文件
└── stylesheets/        # 第三方 CSS 样式库（如需要）
    └── highlight/      # 例如：highlight.js 样式文件
```

## 存放规范

### 1. JavaScript 库

- **存放位置**：`vendor/javascript/` 目录
- **目录结构**：保持原始目录结构（如 `vendor/javascript/highlight.js/`）
- **配置方式**：在 `config/importmap.rb` 中配置引用路径

**示例**：

```ruby
# config/importmap.rb
pin "highlight.js/lib/core", to: "highlight.js/lib/core.js"
pin "highlight.js/lib/languages/ruby", to: "highlight.js/lib/languages/ruby.js"
```

### 2. CSS 样式库

- **原始第三方样式文件**：存放在 `vendor/stylesheets/` 目录
- **项目包装文件**：如果需要对第三方样式进行合并、修改或包装，可以在 `app/assets/stylesheets/` 下创建包装文件

**示例**：

- `vendor/stylesheets/highlight/github.css` - 原始第三方文件
- `app/assets/stylesheets/highlight/github-light.css` - 项目包装文件（引用或合并第三方样式）

**包装文件规范**：

```css
/*
 * This is a wrapper file for highlight.js light theme.
 * The original file is located in vendor/assets/stylesheets/highlight/github-light.css
 * Source: https://github.com/highlightjs/highlight.js/blob/11.11.1/src/styles/github.css
 */

/* 直接复制内容或使用 @import（如果支持） */
```

### 3. 图片资源

#### 项目自己的图片（Logo、图标等）

- **存放位置**：`app/assets/images/` 目录 ⭐ **基础规则**
- **包括**：Logo、Favicon、项目图标、项目图片等
- **使用方式**：通过 `image_tag` 或 `asset_path` 引用

**示例**：
- `app/assets/images/logo.svg` - 项目 Logo
- `app/assets/images/icon.svg` - Favicon
- `app/assets/images/brand/` - 品牌相关图片

#### 第三方图片资源

- **存放位置**：`vendor/assets/images/` 目录
- **包括**：从第三方库下载的图片、图标等

## 文件分类说明

| 文件类型 | 存放位置 | 说明 |
|---------|---------|------|
| **项目图片资源** | `app/assets/images/` 目录 ⭐ | Logo、Favicon、项目图标等 |
| **项目样式文件** | `app/assets/stylesheets/` 目录 | 项目自己的 CSS 样式 |
| **第三方原始文件** | `vendor/` 目录 | 从外部下载的、未经修改的库文件 |
| **项目包装文件** | `app/assets/` 目录 | 对第三方库进行合并、修改或包装的文件 |

## 为什么使用 vendor 目录

- **清晰分离**：区分项目代码和第三方库代码
- **易于管理**：第三方库更新时不会影响项目代码
- **符合 Rails 约定**：Rails 推荐将第三方资源放在 `vendor/` 目录
- **版本控制**：便于跟踪第三方库的版本和来源

## 常见场景

### 场景 0：添加项目 Logo 和图标 ⭐ **基础场景**

**步骤**：

1. 将 Logo 文件放在 `app/assets/images/` 目录
   ```
   app/assets/images/
   ├── logo.svg
   ├── logo-icon.svg
   ├── icon.svg
   └── icon.png
   ```

2. 在视图中使用 `image_tag` 引用
   ```erb
   <%= image_tag "logo.svg", alt: "Logo" %>
   ```

3. 在布局文件中使用 `asset_path` 引用 Favicon
   ```erb
   <link rel="icon" href="<%= asset_path('icon.svg') %>" type="image/svg+xml">
   ```

**重要**：Logo 和项目图片资源必须放在 `app/assets/images/`，不要放在 `public/` 目录。

### 场景 1：集成 highlight.js

**步骤**：

1. 下载文件到 `vendor/javascript/highlight.js/`
2. 在 `config/importmap.rb` 中配置路径
3. 下载样式文件到 `vendor/assets/stylesheets/highlight/`
4. 在 `app/assets/stylesheets/highlight/` 创建包装文件（如需要）

### 场景 2：集成第三方 CSS 框架

**步骤**：

1. 下载原始文件到 `vendor/stylesheets/`
2. 在 `app/assets/stylesheets/` 创建包装文件
3. 在包装文件中引用或合并第三方样式

### 场景 3：使用 npm 包

**注意**：对于复杂的模块化库（如 highlight.js），不能使用 `bin/importmap pin`，需要手动集成：

1. 从 JSPM CDN 下载 ES Module 版本
2. 保存到 `vendor/javascript/`
3. 在 `config/importmap.rb` 中配置

## 注意事项

1. **项目图片资源必须放在 `app/assets/images/`** ⭐ **基础规则**
   - Logo、Favicon、项目图标等必须放在此目录
   - 不要放在 `public/` 目录（除非是静态 HTML 错误页面等特殊需求）

2. **不要使用 `bin/importmap pin` 下载复杂库**：对于模块化库，需要手动下载所有依赖文件

3. **保持原始文件不变**：第三方原始文件放在 `vendor/` 目录，不要修改

4. **包装文件要注明来源**：在包装文件中添加注释，说明原始文件位置

5. **版本控制**：在包装文件中记录第三方库的版本和来源 URL

## 相关文件

- 开发者指南：`docs/DEVELOPER_GUIDE.md`
- Importmap 配置：`config/importmap.rb`
- 样式包装文件：`app/assets/stylesheets/`
