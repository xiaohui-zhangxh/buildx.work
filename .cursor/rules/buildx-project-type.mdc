---
description: BuildX.work 项目类型识别和开发原则。区分 buildx.work 基础项目和 fork 业务项目，明确各自的开发职责。当提到"子项目"、"业务项目"、"fork 项目"、"项目类型"、"文档存储"、"文档操作"、"README.md"、"docs/project-"、"创建文档"、"修改文档"、"项目识别"、"开发职责"、"基础功能"、"业务逻辑"、"扩展功能"、"合并冲突"等关键词，或需要识别项目类型、创建/修改文档、开发业务功能、处理文档规范时参考此规则。
alwaysApply: false
---

# BuildX.work 项目类型识别和开发原则

## 🎯 核心原则

**BuildX.work** 采用 **Fork + Rails Engine + Module 扩展** 的混合架构模式：
- **buildx.work**：专注于基础功能的开发和维护
  - **Engine**：管理基础设施的视图、JavaScript、样式等资源（`engines/buildx_core/`）
  - **主应用**：管理控制器、模型等业务逻辑（`app/`）
- **fork 项目**：专注于业务逻辑开发，不修改基础功能
  - 通过 Module/Concern 扩展基础设施功能
  - 可在主应用中覆盖 Engine 视图（如需要）

## 📁 文档存储规范

### 核心规则

**重要**：为了避免与 buildx.work 合并时产生冲突，必须遵循以下文档存储规范：

1. **根目录 README.md**：
   - ✅ **永远保持为 buildx.work 的文档**
   - ✅ **只做简单介绍和链接**，指向 `engines/buildx_core/README.md` 获取详细文档
   - ❌ **禁止在 fork 项目中修改根目录 README.md**
   - 原因：避免合并冲突，保持与 buildx.work 的兼容性
   - **设计目的**：降低根目录 README 的修改频率，减少合并冲突

2. **Fork 项目文档存储位置**：
   - ✅ 所有 fork 项目的文档存储在 `docs/project-[project-name]/` 目录下
   - ✅ 命名规范：`project-` + 项目名称（小写，使用连字符）
   - ✅ 示例：
     - `docs/project-example/` - 示例项目
     - `docs/project-myapp/` - MyApp 项目
     - `docs/project-business/` - Business 项目

3. **文档结构**：
   ```
   docs/
   ├── [buildx.work 通用文档]          # buildx.work 的文档，保持在 docs 根目录
   │   ├── README.md                    # buildx.work 文档索引
   │   ├── DEVELOPER_GUIDE.md           # 开发者指南
   │   ├── FEATURES.md                  # 功能清单
   │   ├── USAGE_GUIDE.md               # 使用指南
   │   ├── phase-1-authentication/      # 阶段文档
   │   ├── phase-2-authorization/
   │   └── ...
   │
└── project-[project-name]/          # fork 项目的业务文档（仅业务特定文档）
    ├── README.md                   # 项目文档索引（不使用数字前缀）
    ├── 01-BUSINESS_ANALYSIS.md
    ├── 02-PROJECT_PLAN.md
    ├── phase-1-mvp/                # 业务开发阶段文档
    └── ...
   ```

**重要说明**：
- **buildx.work 项目**：文档保持在 `docs/` 根目录，不需要创建 `docs/project-buildx.work/`
- **fork 项目**：
  - buildx.work 的通用文档：保持在 `docs/` 根目录（通过 git merge 同步，不修改）
  - fork 项目的业务文档：存储在 `docs/project-[name]/` 目录
  - **不需要移动 buildx.work 的文档**，它们保持在 `docs/` 根目录即可

### AI 文档操作规范

**当识别为 Fork 项目时，AI 必须**：
- ✅ **所有业务文档的读取和写入操作都在 `docs/project-[project-name]/` 目录下**
- ✅ 不在根目录创建或修改 README.md
- ✅ 不在 `docs/` 根目录下创建或修改业务特定文档（除非是 `project-*` 目录）
- ✅ **可以读取 `docs/` 根目录下的 buildx.work 通用文档（如 `docs/DEVELOPER_GUIDE.md`），但不要修改**
- ✅ 更新 CURRENT_WORK.md 时，只更新 fork 项目相关的内容

**当识别为 BuildX.work 项目时，AI 可以**：
- ✅ 修改根目录 README.md（但应该保持简洁，只做介绍和链接）
- ✅ 修改 `engines/buildx_core/README.md`（详细的基础设施文档）
- ✅ 修改 `docs/` 根目录下的通用文档（如 `docs/DEVELOPER_GUIDE.md`、`docs/phase-*/`）
- ✅ 创建或修改阶段文档（`docs/phase-*/`）
- ✅ **不需要创建 `docs/project-buildx.work/` 目录**，文档直接放在 `docs/` 根目录

## 🔍 项目类型识别

### 识别方法

AI 应该通过以下方式识别当前项目类型：

#### 方法 1：检查 README.md（主要方法）

**buildx.work 项目特征**：
- README.md 标题为 "BuildX.work 🚀"
- README.md 只做简单介绍和链接，指向 `engines/buildx_core/README.md`
- 详细的基础设施文档在 `engines/buildx_core/README.md`

**fork 项目特征**：
- README.md 标题为 "BuildX.work 🚀"（**注意：fork 项目的 README.md 也保持为 buildx.work 的文档，只做简单介绍和链接**）
- 存在业务特定的文档目录（`docs/project-[project-name]/`）
- 通过检查 `docs/project-*/` 目录识别 fork 项目

#### 方法 2：检查文档结构（主要方法）

**buildx.work 项目**：
- 文档结构为通用阶段文档（`docs/phase-1-authentication/`、`docs/phase-2-authorization/` 等）
- **不存在** `docs/project-*/` 目录

**fork 项目**：
- **存在** `docs/project-[project-name]/` 目录（如 `docs/project-example/`、`docs/project-myapp/`）
- 文档描述具体的业务功能
- 通过 `docs/project-*/` 目录识别项目名称

#### 方法 3：检查 Git Remote（辅助方法）

```bash
# 检查 git remote 配置
git remote -v
```

**buildx.work 项目**：
- origin 指向 buildx.work 仓库
- 或没有 upstream remote

**fork 项目**：
- origin 指向业务项目仓库
- upstream 指向 buildx.work 仓库（如果配置了）

### 识别代码示例

```ruby
# 伪代码示例（AI 应该执行的逻辑）
def identify_project_type
  # 方法 1：检查是否存在 project-* 目录（最可靠）
  project_dirs = Dir.glob("docs/project-*/")
  
  if project_dirs.any?
    project_name = project_dirs.first.match(/project-([^\/]+)/)[1]
    return {
      type: :forked_project,
      project_name: project_name,
      project_docs_path: "docs/project-#{project_name}/"
    }
  end
  
  # 方法 2：检查 README.md（辅助方法）
  readme = read_file("README.md")
  
  if readme.title == "BuildX.work 🚀" || 
     readme.contains?("基础设施模板") ||
     readme.contains?("业务网站生成平台")
    return { type: :buildx_work }
  else
    # 默认假设是 buildx.work（更安全）
    return { type: :buildx_work }
  end
end

# 获取 fork 项目文档路径
def get_fork_project_docs_path
  project_dirs = Dir.glob("docs/project-*/")
  return project_dirs.first if project_dirs.any?
  nil
end
```

## 📋 开发职责划分

### BuildX.work 项目职责

**专注领域**：
- ✅ 用户认证系统（邮箱登录、密码找回、会话管理）
- ✅ 权限管理系统（RBAC、Action Policy）
- ✅ 管理后台功能（用户管理、角色管理、系统配置）
- ✅ 多租户支持（租户隔离、组织架构）
- ✅ 基础功能优化和 Bug 修复
- ✅ 测试覆盖率提升
- ✅ 代码质量改进
- ✅ 安全漏洞修复
- ✅ 性能优化

**开发原则**：
- 保持代码通用性，不包含业务特定逻辑
- 通过 Module/Concern 提供扩展点
- 确保所有基础功能都有完整的测试覆盖
- 遵循 Rails 最佳实践

### Fork 项目职责

**专注领域**：
- ✅ 业务逻辑开发（业务模型、业务控制器、业务视图）
- ✅ 业务功能实现（基于基础功能扩展）
- ✅ 业务特定的数据模型
- ✅ 业务特定的 UI/UX
- ✅ 业务集成（第三方 API、AI 服务等）

**开发原则**：
- **不修改基础功能代码**：如果发现基础功能有缺陷，应该：
  1. 记录问题（在开发笔记中）
  2. 等待 buildx.work 修复
  3. 或通过 git merge 同步 buildx.work 的修复
- **通过扩展机制添加功能**：
  - 使用 Module/Concern 扩展基础功能
  - 使用继承扩展基础控制器
  - 使用 partial 扩展基础视图
- **保持与 buildx.work 的兼容性**：
  - 避免直接修改基础代码
  - 确保可以通过 git merge 同步更新

## 🚫 禁止行为

### Fork 项目中禁止的操作

**❌ 禁止直接修改基础功能代码**：
- 不要修改 `app/controllers/application_controller.rb`（除非通过继承或 Concern）
- 不要修改 `app/models/user.rb`（除非通过 Concern 扩展）
- 不要修改 `app/controllers/sessions_controller.rb`
- 不要修改 `app/controllers/admin/` 下的文件
- 不要修改认证、授权相关的核心代码

**❌ 禁止在 fork 项目中修复基础功能 Bug**：
- 如果发现基础功能有 Bug，应该：
  1. 记录问题（在 `notes.md` 中）
  2. 说明问题影响和临时解决方案（如有）
  3. 等待 buildx.work 修复
  4. 通过 git merge 同步修复

**❌ 禁止在 fork 项目中添加基础功能**：
- 不要添加新的基础功能（如新的认证方式、新的权限类型）
- 应该通过 Issue 或 PR 在 buildx.work 中添加

### BuildX.work 项目中禁止的操作

**❌ 禁止添加业务特定逻辑**：
- 不要添加特定业务的功能
- 保持代码通用性

## ✅ 推荐做法

### Fork 项目推荐做法

**✅ 通过扩展机制添加功能**：

```ruby
# ✅ 推荐：通过 Concern 扩展 User 模型
module User::CardExtensions
  extend ActiveSupport::Concern
  
  included do
    has_many :cards, dependent: :destroy
  end
end

# 在 User 模型中 include
class User < ApplicationRecord
  include User::CardExtensions
end
```

```ruby
# ✅ 推荐：通过继承扩展控制器
class CardsController < ApplicationController
  # 业务逻辑
end
```

```ruby
# ✅ 推荐：通过 partial 扩展视图
<%= render "shared/navbar" %>
<%= render "cards/custom_nav" %>
```

**✅ 记录基础功能问题**：

```markdown
## 遇到的问题

### 2025-12-02：基础功能问题

**问题描述**：用户认证功能在某些场景下无法正常工作

**影响范围**：影响业务功能 X

**临时解决方案**：使用 Y 方法绕过

**期望修复**：等待 buildx.work 修复

**相关 Issue**：（如有）
```

**✅ 定期同步 buildx.work 更新**：

```bash
# 同步 buildx.work 的更新
git fetch upstream
git merge upstream/main
```

### BuildX.work 项目推荐做法

**✅ 提供扩展点**：

```ruby
# 在基础代码中提供扩展点
class ApplicationController < ActionController::Base
  # 提供扩展点
  def after_sign_in_path_for(resource)
    # 可以被覆盖
    root_path
  end
end
```

**✅ 使用 Concern 组织代码**：

```ruby
# 使用 Concern 便于扩展
module Authentication
  extend ActiveSupport::Concern
  
  included do
    # 基础功能
  end
end
```

## 🔄 问题处理流程

### 在 Fork 项目中发现基础功能问题

**流程**：

1. **识别问题**：
   - 确认问题属于基础功能（认证、授权、管理后台等）
   - 确认问题不是业务逻辑问题

2. **记录问题**：
   - 在项目的 `notes.md` 中记录问题
   - 说明问题影响和临时解决方案（如有）

3. **等待修复**：
   - 等待 buildx.work 修复
   - 或通过 Issue/PR 在 buildx.work 中报告问题

4. **同步修复**：
   - 通过 `git merge upstream/main` 同步修复
   - 验证修复是否解决问题

### 在 BuildX.work 中修复问题

**流程**：

1. **修复问题**：
   - 在 buildx.work 中修复基础功能问题
   - 编写测试确保修复正确
   - 更新文档

2. **提交修复**：
   - 提交修复到 buildx.work 仓库
   - 确保所有测试通过

3. **通知 fork 项目**：
   - 通过 Release Notes 或 Changelog 通知修复
   - fork 项目可以通过 git merge 同步修复

## 📝 AI 行为规范

### 当识别为 BuildX.work 项目时

**AI 应该**：
- ✅ 专注于基础功能的开发和维护
- ✅ 确保代码通用性
- ✅ 提供扩展点
- ✅ 保持测试覆盖率
- ✅ 遵循 Rails 最佳实践

**AI 不应该**：
- ❌ 添加业务特定逻辑
- ❌ 假设特定业务场景

### 当识别为 Fork 项目时

**AI 应该**：
- ✅ 专注于业务逻辑开发
- ✅ 通过扩展机制添加功能
- ✅ 记录基础功能问题（不直接修复）
- ✅ 保持与 buildx.work 的兼容性
- ✅ **所有文档操作都在 `docs/project-[project-name]/` 目录下**
- ✅ **不修改根目录 README.md**
- ✅ **读取和写入 fork 项目文档时，使用 `docs/project-[project-name]/` 路径**

**AI 不应该**：
- ❌ 直接修改基础功能代码
- ❌ 在 fork 项目中修复基础功能 Bug
- ❌ 添加新的基础功能（应该在 buildx.work 中添加）
- ❌ **修改根目录 README.md**
- ❌ **在 `docs/` 根目录下创建业务特定文档（除非是 `project-*` 目录）**

## 🔍 识别示例

### 示例 1：BuildX.work 项目

**特征**：
- README.md 标题：`# BuildX.work 🚀`
- 文档结构：`docs/phase-1-authentication/`、`docs/phase-2-authorization/`
- 不存在业务特定文档

**识别结果**：`buildx_work`

**开发原则**：专注于基础功能开发和维护

### 示例 2：Fork 业务项目

**特征**：
- README.md 标题：`# BuildX.work 🚀`（保持为 buildx.work 的文档）
- 存在业务特定文档：`docs/project-[project-name]/`（如 `docs/project-example/`）
- 文档描述具体的业务功能

**识别结果**：`forked_project`

**项目文档路径**：`docs/project-[project-name]/`（如 `docs/project-example/`）

**开发原则**：
- 专注于业务逻辑开发，不修改基础功能
- 所有文档操作都在 `docs/project-[project-name]/` 目录下
- 不修改根目录 README.md

## 📚 相关文档

- [BuildX.work 使用指南](../docs/USAGE_GUIDE.md)
- [项目创建指南](../docs/PROJECT_CREATION_GUIDE.md)
- [贡献指南](../docs/CONTRIBUTING.md)

## 📝 文档操作示例

### Fork 项目文档操作示例

**✅ 正确操作**：

```ruby
# 读取 fork 项目文档
read_file("docs/project-[project-name]/00-README.md")
read_file("docs/project-[project-name]/phase-1-mvp/progress.md")

# 写入 fork 项目文档
write("docs/project-[project-name]/phase-1-mvp/notes.md", content)
update("docs/project-[project-name]/07-DEVELOPMENT_PLAN.md", changes)

# 更新 CURRENT_WORK.md（只更新 fork 项目相关内容）
update("CURRENT_WORK.md", fork_project_section)
```

**❌ 错误操作**：

```ruby
# ❌ 不要修改根目录 README.md
write("README.md", fork_project_content)  # 禁止

# ❌ 不要在 docs 根目录创建业务文档
write("docs/MY_PROJECT.md", content)  # 禁止

# ❌ 不要修改 buildx.work 的通用文档（除非是 bug 修复，应该在 buildx.work 中修复）
write("docs/DEVELOPER_GUIDE.md", business_specific_content)  # 禁止
```

### 获取 Fork 项目文档路径

**AI 应该自动识别**：

```ruby
# 自动识别 fork 项目文档路径
def get_fork_project_docs_path
  project_dirs = Dir.glob("docs/project-*/")
  return project_dirs.first if project_dirs.any?
  nil
end

# 使用示例
docs_path = get_fork_project_docs_path
# => "docs/project-[project-name]/"

if docs_path
  read_file("#{docs_path}00-README.md")
  write("#{docs_path}phase-1-mvp/notes.md", content)
end
```

---

**创建时间**：2025-12-02  
**最后更新**：2025-12-02  
**规则版本**：v1.2（更新根目录 README 规范，指向 engines/buildx_core/README.md）
